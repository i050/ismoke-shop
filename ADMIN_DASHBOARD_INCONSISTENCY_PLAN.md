# תוכנית יישום: מערכת ניהול התראות אי-עקביות במוצרים (Admin Dashboard Inconsistency Feature)

## סקירה כללית
מטרת הפיצ'ר היא לספק למנהל המערכת כלי מרכזי לזיהוי וטיפול במוצרים שיש בהם חוסר עקביות בנתוני ה-SKU (למשל: וריאציה אחת עם מידה ואחרת בלי). המערכת תהיה אקטיבית, תציג התראות בדשבורד, ותאפשר ניהול חכם של "התעלמות" (לצמיתות או זמנית).

---

## שלב 1: צד שרת (Backend) - מסד נתונים ו-API

### 1.1 יצירת סכמה (Schema) לניהול התעלמויות
נצור קולקשיין חדש ב-MongoDB בשם `AdminSkuWarningIgnores` לשמירת העדפות המשתמש.

**מבנה המסמך (Schema Definition):**
```javascript
const AdminSkuWarningIgnoreSchema = new Schema({
  productId: { type: Schema.Types.ObjectId, ref: 'Product', required: true },
  warningType: { type: String, default: 'missing_attribute' }, // סוג ההתראה (להרחבה עתידית)
  ignoredUntil: { type: Date, default: null }, // null = התעלם לתמיד, תאריך = התעלם עד לתאריך זה
  createdAt: { type: Date, default: Date.now }
});
```

### 1.2 לוגיקת אגרגציה (Aggregation Logic)
נבנה שאילתה מורכבת שתרוץ על קולקשיין ה-`Products` ותבצע את הפעולות הבאות:
1.  **סריקה:** מעבר על כל המוצרים וה-SKUs שלהם.
2.  **זיהוי:** בדיקה עבור כל מוצר - האם יש attributes שקיימים בחלק מה-SKUs וחסרים באחרים (לוגיקה זהה לזו שמימשנו ב-Frontend).
3.  **סינון:** הצלבת התוצאות מול קולקשיין `AdminSkuWarningIgnores`.
    *   אם קיימת רשומה עבור המוצר עם `ignoredUntil: null` -> הסר מהתוצאות.
    *   אם קיימת רשומה עם `ignoredUntil > Date.now()` -> הסר מהתוצאות.
    *   אחרת -> כלול בתוצאות.

### 1.3 נקודות קצה (API Endpoints)
*   `GET /api/admin/warnings/inconsistencies`: מחזיר את רשימת המוצרים הבעייתיים (מסוננת).
*   `POST /api/admin/warnings/ignore`: יצירת/עדכון רשומת התעלמות.
    *   Body: `{ productId, ignoreType: 'forever' | 'snooze' }`
    *   לוגיקה: אם 'snooze', הגדר `ignoredUntil` ל-4 ימים מהיום.

---

## שלב 2: צד לקוח (Frontend) - ממשק משתמש

### 2.1 רכיב דשבורד (Dashboard Widget)
ניצור קומפוננטה חדשה `InconsistencyWarningWidget` בדף הבית של האדמין.
*   **תצוגה:** מונה (Badge) של מספר המוצרים הדורשים טיפול.
*   **אינטראקציה:** לחיצה על הוידג'ט תפתח את המודאל.

### 2.2 מודאל ניהול התראות (Management Modal)
ניצור מודאל `InconsistencyListModal` שיציג טבלה של המוצרים הבעייתיים.
*   **עמודות:** תמונה, שם מוצר, תיאור הבעיה (למשל: "חסר צבע ב-2 וריאציות").
*   **פעולות (Actions):**
    1.  **כפתור "תקן" (Fix):** יעביר לעריכת המוצר (ראה שלב 3).
    2.  **כפתור "התעלם" (Ignore):** יסמן את המוצר כתקין לתמיד.
    3.  **כפתור "הזכר לי בעוד 4 ימים" (Snooze):** יסתיר את ההתראה זמנית.

### 2.3 אינטגרציה עם Redux/Services
*   הוספת קריאות ה-API ל-`adminProductsService` או service ייעודי חדש.
*   ניהול ה-State של רשימת ההתראות (טעינה, שגיאות, עדכון אופטימי לאחר התעלמות).

---

## שלב 3: אינטגרציה וניווט (Navigation & Deep Linking)

### 3.1 ניווט חכם לעריכה
כאשר המשתמש לוחץ על "תקן":
1.  ניווט ל-URL של עריכת המוצר: `/admin/products/edit/:id`.
2.  הוספת פרמטר ל-URL או שימוש ב-State גלובלי כדי לסמן שיש לפתוח את טאב ה-SKUs מיד.
    *   למשל: `/admin/products/edit/:id?tab=skus&highlight=warnings`.

### 3.2 הדגשה ויזואלית (Highlighting)
בתוך קומפוננטת `ProductForm` / `ProductSKUs`:
*   זיהוי הפרמטר `highlight=warnings`.
*   גלילה אוטומטית לאזור ה-SKUs.
*   פתיחת ה-Accordion הרלוונטי (אם קיים).
*   הדגשה (Focus/Border) של השורות הבעייתיות כדי שהמשתמש יבין מיד מה עליו לתקן.

---

## שלב 4: בדיקות (QA & Testing)

### 4.1 בדיקות יחידה (Unit Tests)
*   בדיקת לוגיקת האגרגציה בשרת (מוודאים שמוצרים תקינים לא חוזרים, ומוצרים מושתקים מסוננים).
*   בדיקת הקומפוננטות החדשות (וידג'ט, מודאל).

### 4.2 בדיקות קצה-לקצה (E2E)
*   תרחיש: יצירת מוצר עם בעיה -> הופעה בדשבורד -> לחיצה על "תקן" -> תיקון -> היעלמות מהדשבורד.
*   תרחיש: יצירת מוצר עם בעיה -> לחיצה על "התעלם" -> היעלמות מהדשבורד.
*   תרחיש: יצירת מוצר עם בעיה -> לחיצה על "הזכר לי אח"כ" -> היעלמות מהדשבורד (ובדיקה במסד הנתונים שהתאריך נכון).

---

## לוח זמנים משוער (סדר עבודה)
1.  **Backend:** יצירת מודל `AdminSkuWarningIgnores` + נתיבי API (כשעתיים).
2.  **Frontend Logic:** חיבור ל-API וניהול State (כשעה).
3.  **Frontend UI:** בניית הוידג'ט והמודאל (כשעתיים).
4.  **Navigation:** מימוש הניווט החכם וההדגשה (כשעה וחצי).
5.  **QA & Refinement:** בדיקות ותיקונים (כשעה).
